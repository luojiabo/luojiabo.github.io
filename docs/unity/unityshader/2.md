
# 第2章 渲染流水线

## 2.1 综述

### 2.1.1 什么是流水线

![](./images/2.1.PNG)

提高效率 专人做专事

### 2.1.2 渲染流水线

计算机将一些列顶点数据、纹理等信息转换成一张人眼可见的图像。

一个渲染流程分为应用阶段，几何阶段，光栅化阶段。
![](./images/2.2.PNG)

应用阶段（CPU）：准备场景数据（相机位置，视锥体，模型，光源等）->剔除->设置渲染状态（漫反射颜色，高光颜色，纹理，shader）->图元信息（点，线，面）。

几何阶段（GPU）：决定绘制的图元是什么，怎么绘制，在那里绘制。把顶点坐标转换到屏幕空间，再到光栅化。输出屏幕空间的二维坐标，顶点的深度值等。

光栅化（GPU）：根据数据产生屏幕上的像素。

## 2.2 CPU与GPU通讯

应用阶段3个阶段：

    （1）把数据加载到现存
    （2）设置渲染状态
    （3）电泳DrawCall

### 2.2.1 把数据加到显存

数据从硬盘加载到系统内存（RAM），网格和纹理等又被加载到显卡存贮空间-显存（VRAM）。
![](./images/2.3.PNG)

### 2.2.2 设置渲染状态

渲染状态：使用哪个着色器（顶点/片源着色器），光源属性，材质等。
如果没有更改，所有网络就使用同一种渲染状态。
![](./images/2.4.PNG)
所有工作准备好以后，调用DrawCall。

### 2.2.3 调用DrawCall

DrawCall：一个命令。指向被需要渲染的图元列表。
![](./images/2.5.PNG)

## 2.3 GPU流水线

GPU流水线：GPU渲染的过程。

### 2.3.1

![](./images/2.6.PNG)
    
GPU 的渲染流水线接收顶点数据作为输入。这些顶点数据是由应用阶段加
载到显存中，再由 Dra Call 指定的。这些数据随后被传递给顶点着色器。
顶点着色器 (Vertex Shader) 是完全可编程的，它通常用千实现顶点的空间变换 顶点着色等功能。 曲面细分着色器 (Tessellation Shader) 是一个可选的着色器，它用于细分图元。 几何着
色器 (Geometry Shader) 同样是一个可选的着色器，它可以被用于执行逐图元 Per-Pr itive
的着色操作，或者被用于产生更多的图元。下一个流水线阶段是裁剪 (Clipping), 这一阶段的目
的是将那些不在摄像机视野内的顶点裁剪掉，并剔除某些 角图元的面片。这个阶段是可配置的。
例如，我们可以使用自定义的裁剪平面来配置裁剪区域，也可以通过指令控制裁剪三角图元的正
面还是背面。几何概念阶段的最后一个流水线阶段是屏幕映射 (Screen Mapping) 。这 阶段是不
可配置和编程的，它负责把每个胆元的坐标转换到屏幕坐标系中。
光栅化概念阶段中的三角形设置 (Triangle Setup) 和三角形遍历 (Triangle Traversal) 阶段
也都是固定函数 (Fixed-Function) 的阶段。接下来的片元着色器 (Fragment Shader), 则是完全
可编程的，它用于实现逐片元 Per-Fragment 的着色操作。最后， 逐片元操作 (Per-Fragment
Operations) 段负责执行很多重要的操作，例如修改颜色、深度缓冲、进行混合等，它不是可
编程的，但具有很高的可配置性。

### 2.3.2 顶点着色器

### 2.3.3 裁剪

### 2.3.4 屏幕映射

### 2.3.5 三角形设置

### 2.3.6 三角形遍历

### 2.3.7 片元着色器

### 2.3.8 逐片元操作

### 2.3.9 总结

## 2.4 容易困惑的地方

## 2.5 明白了吗

## 2.5 扩展